<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Walz Exploit v2</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div id="toast-container"></div>

    <div id="view-login">
        <div class="login-card">
            <div class="brand-big">WALZ<span>EXPLOIT</span></div>
            <p class="login-desc">Advanced WhatsApp Bot Controller</p>
            
            <div class="input-box">
                <input type="tel" id="token-input" placeholder="000000" maxlength="6" autocomplete="off">
            </div>
            
            <button class="btn-login" onclick="attemptLogin()">VERIFY ACCESS</button>
            <p style="margin-top: 20px; font-size: 11px; color: #444;">Dapatkan token dari Bot Telegram Admin</p>
        </div>
    </div>

    <div class="app-container">
        
        <div id="tab-console" class="view active">
            <div class="header">
                <div class="page-title">Console</div>
                <div class="status-badge">
                    <span class="dot" id="dot-status"></span>
                    <span id="txt-status">OFFLINE</span>
                </div>
            </div>

            <div class="console-wrapper">
                <div class="logs" id="logs"></div>
                <div class="cmd-bar">
                    <span style="color:var(--primary); margin-right:10px;">$</span>
                    <input type="text" id="cmd-input" class="cmd-input" placeholder="Execute command...">
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="req('/start')">‚ñ∂ START BOT</button>
                <button class="btn btn-danger" onclick="req('/stop')">‚ñ† STOP</button>
            </div>
        </div>

        <div id="tab-files" class="view">
            <div class="header">
                <div class="page-title">File Manager</div>
                <div onclick="document.getElementById('up').click()" class="status-badge" style="background:var(--primary); color:white; border:none;">
                    + Upload
                </div>
                <input type="file" id="up" hidden onchange="uploadFile()">
            </div>

            <div class="path-bar">
                <span id="current-path">/</span>
                <span onclick="goUp()" style="font-size:16px; cursor:pointer;">‚¨Ü</span>
            </div>

            <div class="file-list" id="file-list"></div>
        </div>

    </div>

    <div id="editor-modal">
        <div class="editor-head">
            <button class="btn-icon" onclick="closeEditor()">‚úï</button>
            <span id="edit-fname" style="font-family:'JetBrains Mono'; font-size:12px;">file.js</span>
            <button class="btn-icon" style="color:var(--primary)" onclick="saveFile()">‚úî</button>
        </div>
        <textarea id="editor-area" spellcheck="false"></textarea>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('console')">
            <span class="nav-icon">‚ö°</span>
            <span>Console</span>
        </button>
        <button class="nav-item" onclick="switchTab('files')">
            <span class="nav-icon">üìÇ</span>
            <span>Files</span>
        </button>
    </div>

    <script>
        const socket = io();
        let path = '';
        let editPath = '';

        if(localStorage.getItem('walz_token')) {
            document.getElementById('view-login').classList.add('hidden');
        }

        function attemptLogin() {
            const t = document.getElementById('token-input').value;
            fetch('/login', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({token: t})
            }).then(r=>r.json()).then(d => {
                if(d.success) {
                    localStorage.setItem('walz_token', t);
                    document.getElementById('view-login').classList.add('hidden');
                    toast('Welcome Back!');
                    loadFiles();
                } else {
                    toast('Token Salah / Expired');
                    document.getElementById('token-input').value = '';
                }
            });
        }

        function getHead() { 
            return {'Authorization': localStorage.getItem('walz_token'), 'Content-Type': 'application/json'}; 
        }

        function req(u, b={}) {
            fetch(u, {method:'POST', headers:getHead(), body:JSON.stringify(b)})
            .then(r=>r.json()).then(d => toast(d.msg || (d.success?'Success':'Fail')));
        }

        socket.on('log', d => {
            const l = document.getElementById('logs');
            l.innerHTML += d.replace(/\x1b\[32m/g, '<span class="ansi-green">')
                            .replace(/\x1b\[31m/g, '<span class="ansi-red">')
                            .replace(/\x1b\[33m/g, '<span class="ansi-yellow">')
                            .replace(/\x1b\[0m/g, '</span>');
            l.scrollTop = l.scrollHeight;
        });

        socket.on('stats', d => {
            document.getElementById('txt-status').innerText = d.status;
            document.getElementById('dot-status').className = 'dot ' + (d.status==='ONLINE'?'online':'');
        });

        document.getElementById('cmd-input').addEventListener('keydown', e => {
            if(e.key === 'Enter') { socket.emit('input', e.target.value); e.target.value = ''; }
        });

        function loadFiles(p = path) {
            fetch('/files', {method:'POST', headers:getHead(), body:JSON.stringify({path:p})})
            .then(r=>r.json()).then(d => {
                if(!d.success) return;
                path = d.currentPath;
                document.getElementById('current-path').innerText = path || '/';
                const l = document.getElementById('file-list');
                l.innerHTML = '';
                d.data.forEach(f => {
                    const safe = f.path.replace(/'/g, "\\'");
                    const icon = f.isDir ? 'üìÅ' : 'üìÑ';
                    const act = f.isDir ? `loadFiles('${safe}')` : `edit('${safe}')`;
                    l.innerHTML += `
                    <div class="file-item">
                        <div class="file-left" onclick="${act}">
                            <span class="f-icon">${icon}</span>
                            <span class="f-name">${f.name}</span>
                        </div>
                        <div class="file-act">
                            ${f.name.endsWith('.zip') ? `<button class="btn-icon" onclick="act('/unzip','${safe}')">üì¶</button>` : ''}
                            <button class="btn-icon" style="color:#ef4444" onclick="act('/delete','${safe}')">üóë</button>
                        </div>
                    </div>`;
                });
            });
        }

        function goUp() {
            if(!path) return;
            const s = path.split('/'); s.pop(); loadFiles(s.join('/'));
        }

        function uploadFile() {
            const f = document.getElementById('up').files[0];
            const fd = new FormData(); fd.append('file', f);
            toast('Uploading...');
            fetch('/upload', {method:'POST', body:fd}).then(()=> { toast('Done'); loadFiles(); });
        }

        function act(u, n) { if(confirm('Yakin?')) req(u, {filename:n}); setTimeout(()=>loadFiles(path), 500); }

        function edit(p) {
            fetch('/read', {method:'POST', headers:getHead(), body:JSON.stringify({path:p})})
            .then(r=>r.json()).then(d => {
                if(d.success) {
                    editPath = p;
                    document.getElementById('edit-fname').innerText = p;
                    document.getElementById('editor-area').value = d.content;
                    document.getElementById('editor-modal').style.display = 'flex';
                }
            });
        }
        function saveFile() {
            req('/save', {path:editPath, content:document.getElementById('editor-area').value});
            closeEditor();
        }
        function closeEditor() { document.getElementById('editor-modal').style.display = 'none'; }

        function switchTab(id) {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('active');
            event.currentTarget.classList.add('active');
            if(id === 'files') loadFiles();
        }

        function toast(m) {
            const t = document.createElement('div'); t.className = 'toast'; t.innerText = m;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(()=>t.remove(), 2500);
        }
    </script>
</body>
</html>