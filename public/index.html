<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WALZ NEXUS // CONTROL</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div id="toast-container"></div>

    <div id="auth-layer">
        <div class="auth-card">
            <div class="glitch-wrapper">
                <h1 class="auth-title" data-text="SYSTEM ACCESS">SYSTEM ACCESS</h1>
            </div>
            <p class="auth-sub">Identity Verification Required</p>
            <div class="input-group">
                <input type="password" id="auth-pass" placeholder="ENTER ACCESS CODE" autocomplete="off">
                <div class="input-line"></div>
            </div>
            <button onclick="authenticate()" class="btn-cyber">INITIALIZE <span class="btn-glare"></span></button>
        </div>
    </div>

    <div id="main-interface">
        <nav class="glass-nav">
            <div class="brand">
                <div class="logo-icon">‚ö°</div>
                <div class="logo-text">NEXUS <span style="color:var(--accent)">V6</span></div>
            </div>
            <div class="nav-links">
                <button class="nav-item active" onclick="setView('console')">TERMINAL</button>
                <button class="nav-item" onclick="setView('files')">DATABASE</button>
            </div>
            <div class="status-badge" id="nav-status">OFFLINE</div>
        </nav>

        <main id="view-console" class="view active">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon">üß†</div>
                    <div class="stat-info">
                        <span class="stat-label">RAM USAGE</span>
                        <span class="stat-val" id="val-ram">-- MB</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-info">
                        <span class="stat-label">CPU LOAD</span>
                        <span class="stat-val" id="val-cpu">-- %</span>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-info">
                        <span class="stat-label">SERVER TIME</span>
                        <span class="stat-val" id="val-time">--:--:--</span>
                    </div>
                </div>
            </div>

            <div class="terminal-wrapper">
                <div class="terminal-header">
                    <div class="term-title">root@nexus:~</div>
                    <div class="term-controls">
                        <button class="term-btn start" onclick="serverAction('/start')">‚ñ∂ BOOT</button>
                        <button class="term-btn stop" onclick="serverAction('/stop')">‚ñ† KILL</button>
                    </div>
                </div>
                <div class="terminal-body" id="logs"></div>
                <div class="terminal-input-area">
                    <span class="prompt">‚ûú</span>
                    <input type="text" id="cmd-input" placeholder="Execute command..." autocomplete="off">
                </div>
            </div>
        </main>

        <main id="view-files" class="view">
            <div class="file-toolbar">
                <div class="search-bar">
                    <input type="text" placeholder="Search files..." id="file-search">
                </div>
                <button class="btn-cyber small" onclick="document.getElementById('upload-input').click()">+ UPLOAD</button>
                <input type="file" id="upload-input" hidden onchange="handleUpload()">
            </div>

            <div class="file-grid" id="file-list">
                </div>
        </main>

        <footer class="cyber-footer">
            <div class="footer-content">
                <span>SYSTEM DEVELOPED BY WALZ</span>
                <div class="socials">
                    <a href="https://wa.me/6281234567890" target="_blank" class="social-link">WHATSAPP</a>
                    <span class="divider">/</span>
                    <a href="https://t.me/yourusername" target="_blank" class="social-link">TELEGRAM</a>
                </div>
            </div>
        </footer>
    </div>

    <div id="editor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <input type="text" id="edit-filename" readonly class="modal-title-input">
                <div class="modal-actions">
                    <button class="btn-text" onclick="closeEditor()">CANCEL</button>
                    <button class="btn-cyber small" onclick="saveFile()">SAVE CHANGES</button>
                </div>
            </div>
            <textarea id="file-content" spellcheck="false"></textarea>
        </div>
    </div>

    <script>
        const socket = io();
        const api = url => fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'} });
        
        if (localStorage.getItem('nexus_token')) {
            document.getElementById('auth-layer').style.display = 'none';
            document.getElementById('main-interface').style.opacity = '1';
        }

        function authenticate() {
            const p = document.getElementById('auth-pass').value;
            fetch('/auth', {
                method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ password: p })
            }).then(r => r.json()).then(d => {
                if (d.success) {
                    localStorage.setItem('nexus_token', d.token);
                    document.getElementById('auth-layer').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('auth-layer').style.display = 'none';
                        document.getElementById('main-interface').style.opacity = '1';
                    }, 500);
                    notify('ACCESS GRANTED', 'success');
                    loadFiles();
                } else {
                    notify('ACCESS DENIED', 'error');
                }
            });
        }

        document.getElementById('auth-pass').addEventListener('keypress', e => { if(e.key === 'Enter') authenticate(); });

        socket.on('log', d => {
            const l = document.getElementById('logs');
            const span = document.createElement('span');
            span.innerHTML = d.replace(/\n/g, '<br>')
                .replace(/\x1b\[31m/g, '<c style="color:#ff5555">')
                .replace(/\x1b\[32m/g, '<c style="color:#50fa7b">')
                .replace(/\x1b\[33m/g, '<c style="color:#f1fa8c">')
                .replace(/\x1b\[36m/g, '<c style="color:#8be9fd">')
                .replace(/\x1b\[0m/g, '</c>');
            l.appendChild(span);
            l.scrollTop = l.scrollHeight;
        });

        socket.on('stats', s => {
            document.getElementById('val-ram').innerText = s.ram;
            document.getElementById('val-cpu').innerText = s.cpu;
            document.getElementById('val-time').innerText = s.time;
            const badge = document.getElementById('nav-status');
            badge.innerText = s.status;
            badge.className = `status-badge ${s.status === 'ONLINE' ? 'online' : ''}`;
        });

        document.getElementById('cmd-input').addEventListener('keydown', e => {
            if(e.key === 'Enter' && e.target.value.trim()) {
                socket.emit('input', e.target.value);
                e.target.value = '';
            }
        });

        function setView(id) {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            event.target.classList.add('active');
            if(id === 'files') loadFiles();
        }

        function serverAction(url) {
            fetch(url, {method: 'POST'}).then(r=>r.json()).then(d => notify(d.msg, d.success ? 'success' : 'error'));
        }

        function loadFiles() {
            fetch('/files').then(r=>r.json()).then(files => {
                const list = document.getElementById('file-list');
                list.innerHTML = '';
                files.forEach(f => {
                    const isZip = f.name.endsWith('.zip');
                    const icon = isZip ? 'üì¶' : (f.isDir ? 'üìÇ' : 'üìÑ');
                    const size = (f.size / 1024).toFixed(1) + ' KB';
                    
                    let actions = '';
                    if(!f.isDir) {
                        if(isZip) actions += `<button onclick="doFile('/unzip', '${f.name}')">EXTRACT</button>`;
                        else actions += `<button onclick="editFile('${f.name}')">EDIT</button>`;
                        actions += `<button class="danger" onclick="doFile('/delete', '${f.name}')">DEL</button>`;
                    }
                    
                    list.innerHTML += `
                    <div class="file-card">
                        <div class="file-top">
                            <div class="file-icon">${icon}</div>
                            <div class="file-meta">
                                <div class="file-name">${f.name}</div>
                                <div class="file-size">${size}</div>
                            </div>
                        </div>
                        <div class="file-actions">${actions}</div>
                    </div>`;
                });
            });
        }

        function doFile(endpoint, name) {
            if(!confirm('Confirm action?')) return;
            fetch(endpoint, {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({filename: name})
            }).then(r=>r.json()).then(d => {
                notify(d.msg, d.success ? 'success' : 'error');
                loadFiles();
            });
        }

        function editFile(name) {
            fetch('/file/read', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({filename: name})
            }).then(r=>r.json()).then(d => {
                if(d.success) {
                    document.getElementById('edit-filename').value = name;
                    document.getElementById('file-content').value = d.content;
                    document.getElementById('editor-modal').style.display = 'flex';
                } else notify('Failed to read file', 'error');
            });
        }

        function saveFile() {
            const name = document.getElementById('edit-filename').value;
            const content = document.getElementById('file-content').value;
            fetch('/file/save', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({filename: name, content: content})
            }).then(r=>r.json()).then(d => {
                notify(d.msg, d.success?'success':'error');
                if(d.success) closeEditor();
            });
        }

        function closeEditor() {
            document.getElementById('editor-modal').style.display = 'none';
        }

        function handleUpload() {
            const fd = new FormData();
            fd.append('file', document.getElementById('upload-input').files[0]);
            notify('Uploading...', 'normal');
            fetch('/upload', {method:'POST', body:fd}).then(() => {
                notify('Upload complete', 'success');
                loadFiles();
            });
        }

        function notify(msg, type) {
            const box = document.getElementById('toast-container');
            const el = document.createElement('div');
            el.className = `toast ${type}`;
            el.innerText = `>> ${msg}`;
            box.appendChild(el);
            setTimeout(() => el.remove(), 3000);
        }
    </script>
</body>
</html>
