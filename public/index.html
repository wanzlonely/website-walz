<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PRIME</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --glass: rgba(10, 10, 20, 0.85); --border: #333; --accent: #00ffcc; --danger: #ff3366; --text: #eee; }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Rajdhani', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        .flex { display: flex; gap: 8px; }
        
        header { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); }
        .brand { font-size: 22px; font-weight: bold; color: var(--accent); letter-spacing: 2px; }
        .stats { font-family: 'JetBrains Mono'; font-size: 11px; color: #888; }
        .stats span { color: var(--accent); }

        .layout { display: flex; flex: 1; overflow: hidden; }
        aside { width: 300px; border-right: 1px solid var(--border); padding: 15px; display: flex; flex-direction: column; background: var(--glass); }
        
        .upload-zone { border: 1px dashed var(--border); padding: 15px; text-align: center; border-radius: 6px; cursor: pointer; transition: 0.2s; margin-bottom: 20px; }
        .upload-zone:hover { border-color: var(--accent); background: rgba(0, 255, 204, 0.05); }
        
        .file-list { flex: 1; overflow-y: auto; }
        .card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 10px; margin-bottom: 8px; border-radius: 4px; }
        .card-head { display: flex; justify-content: space-between; margin-bottom: 8px; font-family: 'JetBrains Mono'; font-size: 12px; }
        .dot { width: 6px; height: 6px; background: #444; border-radius: 50%; box-shadow: 0 0 5px #444; }
        .dot.on { background: var(--accent); box-shadow: 0 0 8px var(--accent); }

        button { background: transparent; border: 1px solid var(--border); color: #ccc; padding: 6px; cursor: pointer; font-family: 'JetBrains Mono'; font-size: 10px; flex: 1; border-radius: 3px; transition: 0.2s; }
        button:hover { border-color: var(--accent); color: var(--accent); }
        .btn-red:hover { border-color: var(--danger); color: var(--danger); }

        main { flex: 1; background: #000; padding: 20px; display: flex; flex-direction: column; }
        .terminal { flex: 1; background: rgba(10,10,10,0.9); border: 1px solid var(--border); border-radius: 6px; padding: 15px; font-family: 'JetBrains Mono'; font-size: 12px; overflow-y: auto; white-space: pre-wrap; color: #bbb; box-shadow: inset 0 0 20px rgba(0,0,0,0.8); }

        #login { position: fixed; inset: 0; background: #000; z-index: 99; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        input { background: #111; border: 1px solid var(--border); padding: 12px; width: 250px; color: var(--accent); text-align: center; font-family: 'JetBrains Mono'; margin-bottom: 10px; border-radius: 4px; }
        
        #editor { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 50; display: none; padding: 30px; }
        .editor-box { width: 100%; height: 100%; background: #111; border: 1px solid var(--border); display: flex; flex-direction: column; }
        textarea { flex: 1; background: #080808; border: none; color: #ccc; padding: 20px; font-family: 'JetBrains Mono'; resize: none; font-size: 13px; }

        .ansi-red { color: var(--danger); } .ansi-green { color: var(--accent); } .ansi-yellow { color: #ffd700; } .ansi-blue { color: #3b82f6; }
        
        @media (max-width: 700px) { .layout { flex-direction: column; } aside { width: 100%; height: 40%; } }
    </style>
</head>
<body>
    <div id="login">
        <h1 class="brand" style="margin-bottom: 20px;">SYSTEM ACCESS</h1>
        <input type="password" id="pass" placeholder="PASSPHRASE">
        <button onclick="auth()" style="width: 250px; padding: 12px;">UNLOCK</button>
    </div>

    <header>
        <div class="brand">NEXUS</div>
        <div class="stats" id="stats">RAM: -</div>
    </header>

    <div class="layout">
        <aside>
            <form action="/upload" method="POST" enctype="multipart/form-data" id="fup">
                <input type="file" name="scriptFile" id="fin" style="display:none" onchange="document.getElementById('fup').submit()">
                <div class="upload-zone" onclick="document.getElementById('fin').click()">+ UPLOAD ZIP / JS</div>
            </form>
            <div class="file-list" id="list"></div>
        </aside>
        <main>
            <div class="terminal" id="term"></div>
        </main>
    </div>

    <div id="editor">
        <div class="editor-box">
            <div style="padding:10px; border-bottom:1px solid #333; display:flex; justify-content:space-between;">
                <span id="ed-name" style="color:var(--accent)">EDIT</span>
                <div class="flex"><button onclick="save()">SAVE</button><button onclick="closeEd()" class="btn-red">CLOSE</button></div>
            </div>
            <textarea id="ed-code"></textarea>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const term = document.getElementById('term');
        let active = [];

        socket.on('log', d => {
            term.innerHTML += d.replace(/\x1b\[31m/g, '<span class="ansi-red">').replace(/\x1b\[32m/g, '<span class="ansi-green">').replace(/\x1b\[33m/g, '<span class="ansi-yellow">').replace(/\x1b\[36m/g, '<span class="ansi-blue">').replace(/\x1b\[0m/g, '</span>');
            term.scrollTop = term.scrollHeight;
        });
        socket.on('status_update', l => { active = l; ref(); });
        socket.on('sys_stats', s => document.getElementById('stats').innerHTML = `MEM: ${s.ram} | HOST: ${s.total}`);

        function auth() {
            fetch('/login', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:document.getElementById('pass').value}) })
            .then(r=>r.json()).then(d=>{ if(d.success) { document.getElementById('login').classList.add('hidden'); ref(); } else alert('DENIED'); });
        }

        function ref() {
            fetch('/files').then(r=>r.json()).then(files => {
                const l = document.getElementById('list'); l.innerHTML = '';
                files.forEach(f => {
                    const on = active.includes(f);
                    const dir = !f.includes('.');
                    l.innerHTML += `<div class="card"><div class="card-head"><span style="color:${dir?'var(--accent)':'#fff'}">${dir?'ðŸ“‚ ':'ðŸ“„ '}${f}</span><div class="dot ${on?'on':''}"></div></div><div class="flex">${on?`<button class="btn-red" onclick="req('/stop','${f}')">HALT</button>`:`<button onclick="req('/start','${f}')">EXEC</button>`}<button onclick="edit('${f}')">EDIT</button><button class="btn-red" onclick="del('${f}')">DEL</button></div></div>`;
                });
            });
        }

        function req(u, f) { fetch(u, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({filename:f}) }); }
        function del(f) { if(confirm('DELETE?')) req('/delete', f); setTimeout(ref, 500); }
        function edit(f) { fetch('/read', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({filename:f}) }).then(r=>r.json()).then(d=>{ document.getElementById('editor').style.display='flex'; document.getElementById('ed-name').innerText=f; document.getElementById('ed-code').value=d.content; }); }
        function save() { fetch('/save', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({filename:document.getElementById('ed-name').innerText, content:document.getElementById('ed-code').value}) }).then(()=>closeEd()); }
        function closeEd() { document.getElementById('editor').style.display='none'; }
    </script>
</body>
</html>
